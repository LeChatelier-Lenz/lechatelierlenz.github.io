# 比特币

> 来自《比特币白皮书》

## 简介

> 在这篇论文中，我们提出一种使用点对点分布式时间戳服务器为基于时间的交易序列生成**计算上的证据**来解决双重支付问题的方案。只要诚实节点集体控制的 CPU 算力大于任何一个合作攻击节点群的CPU 算力，这个系统就是安全的。

根据比特币白皮书中的简介，比特币交易系统具有以下几个特点：

1. **去中心化**：交易系统基于密码学而非信任，参与者之间可以直接交易，无需可信任的第三方金融机构。
  
2. **不可撤销性**：交易一旦确认，在计算上无法撤销，保护了卖家免受欺诈。

3. **低交易成本**：通过避免第三方仲裁，降低了交易成本，特别适合小额交易。

4. **双重支付防护**：通过使用点对点分布式时间戳服务器，系统提供了防止双重支付的解决方案。

5. **基于计算的安全性**：只要诚实节点的计算能力超过恶意节点的总和，系统即保持安全。

6. **程序化合约支持**：可以通过编程实现保护买家的合约机制。



## 比特币交易

- 将一枚电子货币定义为一条数字签名链

  > 解决的问题，防止被篡改

  - 货币中要包含交易的基础信息
  - 每个拥有者都需要将一个**特殊数字签名*S***添加到**货币末尾**
    - S <= 当前所有者的私钥SK数字签名(**哈希H**(上一次交易，下一个拥有者的公钥))

  - 随后将该货币*转移*给下一个拥有者
    - 收款人可以通过验证数字签名来证实其为该链的所有者
      - 利用前一个人的公钥来验证
  - 流程示意图：
    <img src="C:\Users\耳东七月\AppData\Roaming\Typora\typora-user-images\image-20240923140512965.png" alt="image-20240923140512965" style="zoom:50%;" />

- 留下的问题：

  - 收款人无法证实某个拥有者没有对此货币进行**双重支付**

    > 即前一个所有者同时将该货币用于了多个地方的支付

    - 通常做法是引入一个可信任的第三方中央机构

  - 需要一种能让收款人知道上一个货币拥有者**没有对任何更早的交易签名**的方法



> 附：比特币的UTXO模型





## 时间戳服务器

> 解决双重支付的去中心化方案part1

- 将交易记录按**时间顺序排列**并公开广播，生成了一种基于时间的交易序列

  **交易集合**：比特币网络中的节点将一定数量的**交易**打包到一个**区块**中。

  **哈希计算**：每个区块都通过哈希函数生成一个唯一的哈希值。这个哈希值不仅反映了当前区块中的交易数据，==还链接了前一个区块的哈希==，形成区块链。

  **时间戳记录**：每个区块都有一个时间戳，标记了区块被创建和添加到链中的时间。

  **公开广播**：时间戳服务器会将区块链的哈希值**公开广播**，以确保网络中的所有节点都能看到最新的交易记录，**证明交易在特定时间之前发生**。

<img src="C:\Users\耳东七月\AppData\Roaming\Typora\typora-user-images\image-20240923141556922.png" alt="image-20240923141556922" style="zoom:50%;" />



## 工作量证明

- 为了实现一个基于点对点的时间戳服务器的正常运行，我们需要一个**工作量**证明系统

  - 工作量证明：在区块中加入一个随机数，要使得满足区块的哈希值拥有**一定数量的前置0比特数**才能建立新区块

    - 这当中的“工作量”在于 **消耗CPU算力**找到这样的随机数nonce
    - 后续除非重做这个工作否则就无法更改区块（改变这个区块就需要重做后面所有的区块）

    <img src="C:\Users\耳东七月\AppData\Roaming\Typora\typora-user-images\image-20240923144519577.png" alt="image-20240923144519577" style="zoom:50%;" />

- 工作量如何解决多数决定中确定投票方式的问题：==按CPU投票==
  - 最长的链代表了多数决定 =》 有最大的计算工作量证明的算力投入到这条链上
  - 如果多数的CPU算力被诚实节点控制，诚实的链就会增长的最快并超过其他的竞争链。
- 为了抵消硬件运算速度的增加以及平衡不同时期运行节点的利益，工作量证明的难度将由**移动平均数**法来确定每小时生成区块的平均数。如果区块生成的过快，那么生成的难度就会增加



## 比特币网络

- 运行网络的步骤如下
  - 新交易将向所有节点广播
  - 每个节点将新交易收集到一个区块
  - 每个节点为他的区块**寻找工作量证明**
  - 当一个节点找到了工作量证明，就向所有节点广播这个区块
  - 节点只有在区块内所有交易都是有效的且之前没有被支付过的情况下接收这个区块
  - 节点通过使用这个区块的哈希值作为“上一个哈希值”，在链中创建下一个区块的方式**表示对这个区块的接受**
- 节点总是**认为最长的链为正确的**并持续致力于延长他。
  - 如果两个节点同时广播了不同的下一区块，有些节点可能先收到其中一个而其它节点先收到另一个。
    - 这种情况下，节点基**于他们收到的第一个区块工作**，但是也保存另一个分支以防它变为更长的链。
    - 当下一个工作量证明被找到后僵局就会被打破，从而其中一个分支变得更长。
- 新的广播不必到达所有的节点，只需要到达一些节点，不久就会进入到一个区块。
  - 区块广播也是**能容忍消息丢失**的，如果一个节点没有收到某个区块，它将在收到下一个区块时发现它丢失了一个区块然后**去请求这个区块**



## 激励

- 约定区块中**第一笔交易**是区块创建者开创一枚属于他的新货币的*特殊的交易*

  - 【系统】=》【“挖矿者”】

  - 增加了对支持网络的节点的激励

  - 确保了工作量证明机制得以运行

    > 实际上消耗的是CPU时间和电力

- **激励也可以由交易费充当**。如果交易的输出值小于其输入值，差价就作为交易费被加到包含此交易的区块的激励当中。

  - 一旦预定量的货币进入了流通领域，激励将变为只含有交易费，这样可以完全避免通货膨胀

- ==激励会有助于鼓励节点保持诚实==。

  - 如果一个贪心的攻击者有能力聚集比所有诚实节点更多的 CPU 算力
    - 他将面临是**以骗回已付款的方式欺诈别人**还是**使用这些算力生成新货币**的抉择。
    - 他将发现**遵守规则**比破坏系统和他自己财产的有效性更有利，因为这些规则准
      许他获得比所有其他人都多的新货币。



## Merkle树与压缩存储



